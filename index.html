<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Ronda de Extintores</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    select, input, button { margin: 5px; padding: 5px; }
    .extintor { display: inline-block; margin: 5px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; cursor: pointer; }
    .vistoriado { background-color: #4CAF50; color: white; }
    #mensagem {
      margin:10px 0;
      padding:8px;
      display:none;
      border-radius:4px;
      font-weight:bold;
    }
    /* Caixa de confirma√ß√£o customizada */
    #confirmBox {
      display:none;
      position:fixed;
      top:0; left:0; right:0; bottom:0;
      background:rgba(0,0,0,0.5);
      justify-content:center;
      align-items:center;
      z-index:1000;
    }
    #confirmBox .conteudo {
      background:#fff;
      padding:20px;
      border-radius:8px;
      text-align:center;
      max-width:300px;
      box-shadow:0 2px 8px rgba(0,0,0,0.3);
    }
    #confirmBox button {
      margin:10px;
      padding:8px 15px;
      border:none;
      border-radius:4px;
      cursor:pointer;
      font-weight:bold;
    }
    #confirmSim { background:#dc3545; color:#fff; }
    #confirmNao { background:#6c757d; color:#fff; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
</head>
<body>
  <h1>Ronda de Extintores</h1>

  <!-- Campo de mensagens -->
  <div id="mensagem"></div>

  <label for="nome">Seu nome:</label>
  <input type="text" id="nome" placeholder="Digite seu nome">

  <br>

  <label for="edificacao">Escolha a edifica√ß√£o:</label>
  <select id="edificacao"></select>

  <button id="resetGeral">Resetar TODOS os extintores</button>

  <div id="extintores"></div>

  <!-- Caixa de confirma√ß√£o customizada -->
  <div id="confirmBox">
    <div class="conteudo">
      <p id="confirmMensagem">Tem certeza?</p>
      <button id="confirmSim">Sim</button>
      <button id="confirmNao">Cancelar</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, set, get, update, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

    // Configura√ß√£o do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyC7lypBBMv9RJ7ta3uaXTiU4txg8x91TWI",
      authDomain: "ronda-extintores.firebaseapp.com",
      projectId: "ronda-extintores",
      storageBucket: "ronda-extintores.firebasestorage.app",
      messagingSenderId: "712050420595",
      appId: "1:712050420595:web:96ce82f25307c7aba4f306",
      measurementId: "G-S8SERMVVCR"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth();

    signInAnonymously(auth).catch(error => console.error(error));

    // Fun√ß√£o para exibir mensagens personalizadas
    function mostrarMensagem(texto, tipo="info") {
      const msg = document.getElementById("mensagem");
      msg.innerText = texto;

      if (tipo === "sucesso") {
        msg.style.background = "#d4edda";
        msg.style.color = "#155724";
        msg.style.border = "1px solid #c3e6cb";
      } else if (tipo === "erro") {
        msg.style.background = "#f8d7da";
        msg.style.color = "#721c24";
        msg.style.border = "1px solid #f5c6cb";
      } else {
        msg.style.background = "#cce5ff";
        msg.style.color = "#004085";
        msg.style.border = "1px solid #b8daff";
      }

      msg.style.display = "block";
      setTimeout(() => { msg.style.display = "none"; }, 5000);
    }

    // Fun√ß√£o para confirma√ß√£o customizada
    function confirmarAcao(mensagem, callbackSim) {
      const box = document.getElementById("confirmBox");
      document.getElementById("confirmMensagem").innerText = mensagem;
      box.style.display = "flex";

      document.getElementById("confirmSim").onclick = () => {
        box.style.display = "none";
        callbackSim();
      };
      document.getElementById("confirmNao").onclick = () => {
        box.style.display = "none";
      };
    }

    // Popula o select de edifica√ß√µes
    const edificacoes = [
      "DESEMBARQUE",
      "TPS T√âRREO",
      "TPS SUPERIOR",
      "ADM/R√ÅDIO",
      "CASA DE BOMBAS",
      "CAMPO DE ANTENAS",
      "EMBARQUE",
      "ELOS",
      "APOC/P√ÅTIO AVIA√á√ÉO GERAL",
      "PORT√ÉO 1",
      "KF",
      "PAA",
      "MANUTEN√á√ÉO",
      "SCI"
    ];
    const select = document.getElementById("edificacao");
    edificacoes.forEach(ed => {
      const opt = document.createElement("option");
      opt.value = ed;
      opt.innerText = ed;
      select.appendChild(opt);
    });

    // Exibe os extintores da edifica√ß√£o
    function carregarExtintores(edificacao) {
      const container = document.getElementById("extintores");
      container.innerHTML = "";

      const extRef = ref(db, "extintores/" + edificacao);
      onValue(extRef, snapshot => {
        container.innerHTML = "";
        snapshot.forEach(child => {
          const numero = child.key;
          const dados = child.val();
          const btn = document.createElement("div");
          btn.className = "extintor" + (dados.vistoriado ? " vistoriado" : "");
          btn.innerText = numero;

          btn.onclick = () => {
            const nome = document.getElementById("nome").value.trim();
            if (!nome) {
              mostrarMensagem("‚ö†Ô∏è Digite seu nome antes de marcar extintores.", "erro");
              return;
            }

            const novoEstado = !dados.vistoriado;
            update(ref(db, "extintores/" + edificacao + "/" + numero), {
              vistoriado: novoEstado,
              vistoriadoPor: novoEstado ? nome : "",
              vistoriadoEm: novoEstado ? new Date().toISOString() : null
            });
          };

          container.appendChild(btn);
        });
      });
    }

    select.onchange = () => carregarExtintores(select.value);

    // Reset geral com confirma√ß√£o customizada
    document.getElementById("resetGeral").onclick = () => {
      confirmarAcao("Tem certeza que deseja resetar TODOS os extintores?", () => {
        edificacoes.forEach(ed => {
          const extRef = ref(db, "extintores/" + ed);
          get(extRef).then(snapshot => {
            snapshot.forEach(child => {
              update(ref(db, "extintores/" + ed + "/" + child.key), {
                vistoriado: false,
                vistoriadoPor: "",
                vistoriadoEm: null
              });
            });
          });
        });
        mostrarMensagem("üîÑ Todos os extintores foram resetados!", "info");
      });
    };

    // Fun√ß√£o para criar extintores iniciais (rodar 1x no console)
    window.seedExtintores = function() {
      edificacoes.forEach(ed => {
        for (let i = 1; i <= 5; i++) { // exemplo: 5 extintores
          set(ref(db, "extintores/" + ed + "/" + i), {
            vistoriado: false,
            vistoriadoPor: "",
            vistoriadoEm: null
          });
        }
      });
      mostrarMensagem("‚úÖ Base inicial criada!", "sucesso");
    };

    // Carrega a primeira edifica√ß√£o ao abrir
    carregarExtintores(select.value);
  </script>
</body>
</html>
