<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Controle de Inspe√ß√£o</title>
  <style>
    body {
      width: 100vw;
      height: 100%;
      font-family: Arial, sans-serif;
      margin: 0;
      background: url(https://images.pexels.com/photos/5965211/pexels-photo-5965211.jpeg?_gl=1*1nkppr7*_ga*MTAyODczODAzNC4xNzU1MTE4Mzc1*_ga_8JE65Q40S6*czE3NTc2MDQ3MDEkbzYkZzEkdDE3NTc2MDUwNTEkajgkbDAkaDA.);
      background-size: cover;
      background-position: center;
      box-shadow: inset 0 0 0 100vh rgb(0 0 0 / 30%);
    }
    .corpo-container {
      display: block;
      position: absolute;
      width: 80%;
      left: 10%;
      height: 80%;
      top: 5%;
      background: rgb(0 0 0 / 70%);
      border-radius: 3em;
    }
    h1.titulo-principal {
      width: 80%;
      color: #fff;
      font-size: 3.2em;
      background: rgb(0 0 0 / 60%);
      margin: 0;
      padding: 5% 10%;
      border-radius: 1em 1em 0 0;
    }
    .usuario {
      display: flex;
      padding: 3% 5%;
      flex-direction: row;
      align-items: center;
      background: rgb(0 0 0 / 40%);
      border-top: 1px solid rgb(255 255 255 / 20%);
    }
    .usuario label {
      width: 36%;
      font-size: 2.4em;
      color: #fff;
      padding: 0 2%;
      white-space: nowrap;
    }
    input#nomeUsuario {
      width: 58%;
      font-size: 2.5em;
      padding: 3% 0 3% 6%;
      color: #ffffffb5;
      background: rgb(255 255 255 / 10%);
      border: none;
      border-radius: 0.5em;
    }
    input#nomeUsuario:focus {
      border: none;
      box-shadow: 0 0 5px rgb(255 255 255 / 20%);
    }
    .edificacoes {
      display: flex;
      padding: 3% 5%;
      flex-direction: row;
      align-items: center;
      background: rgb(0 0 0 / 40%);
      border-top: 1px solid rgb(255 255 255 / 20%);
    }
    .edificacoes label {
      width: 34%;
      font-size: 2.4em;
      color: #fff;
      padding: 0 2%;
      white-space: nowrap;
    }
    select#edificacao {
      width: 62%;
      font-size: 2.4em;
      color: #ffffffb5;
      padding: 3% 0 3% 4%;
      white-space: nowrap;
      background: rgb(255 255 255 / 10%);
      border: none;
      border-radius: 0.5em;
    }
    #extintores {
      display: flex;
      flex-direction: column;
    }
    div#extintores button:before {
      content: "üßØ";
    }
    #extintores button {
      font-size: 2.1em;
      width: fit-content;
      min-width: 5em;
      padding: 2% 5%;
      margin-left: 7%;
      border-radius: 0.6em;
      white-space: nowrap;
      color: #fff;
      font-weight: 100;
      font-family: math;
    }
    #extintores .vistoriado {
      background: #005112f2;
      color: #fff;
    }
    #extintores .nao-vistoriado {
      background: rgb(0 0 0 / 90%);
    }
    button#reset {
      position: absolute;
      margin: 0;
      padding: 4%;
      width: 80%;
      left: 10%;
      bottom: 10vh;
      font-size: 2.5em;
      background: rgb(0 0 0 / 80%);
      color: #fff;
      border-radius: 1em;
    }
    .vistoriado { background: #28a745; color: #fff; }
    .nao-vistoriado { background: #f0f0f0; color: #000; }
    #mensagem { margin:10px; padding:8px; display:none; border-radius:4px; font-weight:bold; }
  </style>
</head>
<body>
 <div class="corpo-container">
  <h1 class="titulo-principal">Controle de Inspe√ß√£o dos Extintores</h1>
 <div class="usuario">
  <label for="nomeUsuario">Seu nome:</label>
  <input type="text" id="nomeUsuario" placeholder="Digite seu nome">
 </div>
 <div class="edificacoes">
  <label for="edificacao">Edifica√ß√£o:</label>
  <select id="edificacao"></select>
 </div>
  <div id="extintores" style="margin-top:20px;"></div>
 </div>

  <div id="mensagem"></div>

  <br>
  <button id="reset" onclick="resetarTodos()">üîÑ Resetar TODOS os extintores</button>
  <div id="confirmReset" style="display:none; margin-top:10px;">
    <span>Tem certeza que deseja resetar TODOS os extintores?</span>
    <button onclick="confirmReset(true)">‚úÖ Sim</button>
    <button onclick="confirmReset(false)">‚ùå N√£o</button>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // üîπ SUA CONFIG FIREBASE AQUI
    const firebaseConfig = {
      apiKey: "AIzaSyC7lypBBMv9RJ7ta3uaXTiU4txg8x91TWI",
      authDomain: "ronda-extintores.firebaseapp.com",
      projectId: "ronda-extintores",
      storageBucket: "ronda-extintores.firebasestorage.app",
      messagingSenderId: "712050420595",
      appId: "1:712050420595:web:96ce82f25307c7aba4f306",
      measurementId: "G-S8SERMVVCR",
      databaseURL: "https://ronda-extintores-default-rtdb.firebaseio.com/"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // üîπ Sistema de mensagens
    function mostrarMensagem(texto, tipo="info") {
      const msg = document.getElementById("mensagem");
      msg.innerText = texto;

      if (tipo === "sucesso") {
        msg.style.background = "#d4edda";
        msg.style.color = "#155724";
        msg.style.border = "1px solid #c3e6cb";
      } else if (tipo === "erro") {
        msg.style.background = "#f8d7da";
        msg.style.color = "#721c24";
        msg.style.border = "1px solid #f5c6cb";
      } else {
        msg.style.background = "#cce5ff";
        msg.style.color = "#004085";
        msg.style.border = "1px solid #b8daff";
      }

      msg.style.display = "block";
      setTimeout(() => { msg.style.display = "none"; }, 5000);
    }

    // üîπ Marcar extintor com nome obrigat√≥rio
    function toggleExtintor(edificacao, numero) {
      const nomeUsuario = document.getElementById("nomeUsuario").value.trim();

      if (!nomeUsuario) {
        mostrarMensagem("‚ö†Ô∏è Digite seu nome antes de marcar a vistoria!", "erro");
        return;
      }

      const ref = db.ref(`extintores/${edificacao}/${numero}`);
      ref.once("value").then(snapshot => {
        const atual = snapshot.val() || {};
        const novoStatus = !atual.vistoriado;
        ref.update({
          vistoriado: novoStatus,
          por: novoStatus ? nomeUsuario : ""
        });
      });
    }

    // üîπ Renderizar extintores (mostra quem marcou)
    function renderizarExtintores(edificacao) {
      const container = document.getElementById("extintores");
      container.innerHTML = "";

      const ref = db.ref(`extintores/${edificacao}`);
      ref.on("value", snapshot => {
        const dados = snapshot.val();
        container.innerHTML = "";

        if (!dados) {
          container.innerHTML = "<p>Nenhum extintor cadastrado.</p>";
          return;
        }

        Object.keys(dados).forEach(numero => {
          const ext = dados[numero];
          const btn = document.createElement("button");
          btn.id = `ext-${edificacao}-${numero}`;
          btn.innerText = ext.vistoriado ? `${numero} ‚úÖ (${ext.por})` : numero;
          btn.className = ext.vistoriado ? "vistoriado" : "nao-vistoriado";
          btn.onclick = () => toggleExtintor(edificacao, numero);
          container.appendChild(btn);
        });
      });
    }

    // üîπ Reset geral
    // Mostra confirma√ß√£o personalizada
function resetarTodos() {
  document.getElementById("confirmReset").style.display = "block";
}

// A√ß√£o do usu√°rio
function confirmReset(decisao) {
  const container = document.getElementById("confirmReset");
  container.style.display = "none";

  if (!decisao) return; // Cancelou

  db.ref("extintores").once("value").then(snapshot => {
    const updates = {};
    snapshot.forEach(ed => {
      ed.forEach(ext => {
        updates[`extintores/${ed.key}/${ext.key}`] = { vistoriado: false, por: "" };
      });
    });
    db.ref().update(updates)
      .then(() => mostrarMensagem("üîÑ Todos os extintores foram resetados!", "sucesso"))
      .catch(err => mostrarMensagem("‚ùå Erro ao resetar: " + err.message, "erro"));
  });
}


    // üîπ Fun√ß√£o seed organizada
    function seedExtintores() {
      const edificacoes = {
        "DESEMBARQUE": [1,2,3,4,5],
        "TPS T√âRREO": [6,7,8],
        "TPS SUPERIOR": [9,10,11],
        "ADM/R√ÅDIO": [12,13],
        "CASA DE BOMBAS": [14,15],
        "CAMPO DE ANTENAS": [16],
        "EMBARQUE": [17,18,19],
        "ELOS": [20,21],
        "APOC/P√ÅTIO AVIA√á√ÉO GERAL": [22,23,24],
        "PORT√ÉO 1": [25,26],
        "KF": [27],
        "PAA": [28,29],
        "MANUTEN√á√ÉO": [30,31],
        "SCI": [32]
      };

      const updates = {};
      Object.keys(edificacoes).forEach(ed => {
        edificacoes[ed].forEach(num => {
          updates[`extintores/${ed}/${num}`] = { vistoriado: false, por: "" };
        });
      });

      db.ref().update(updates)
        .then(() => mostrarMensagem("‚úÖ Extintores carregados com sucesso!", "sucesso"))
        .catch(err => mostrarMensagem("‚ùå Erro ao carregar extintores: " + err.message, "erro"));
    }

    // üîπ Popular select com edifica√ß√µes
    const edificacoesArray = [
      "DESEMBARQUE", "TPS T√âRREO", "TPS SUPERIOR",
      "ADM/R√ÅDIO", "CASA DE BOMBAS", "CAMPO DE ANTENAS",
      "EMBARQUE", "ELOS", "APOC/P√ÅTIO AVIA√á√ÉO GERAL",
      "PORT√ÉO 1", "KF", "PAA", "MANUTEN√á√ÉO", "SCI"
    ];

    const select = document.getElementById("edificacao");
    edificacoesArray.forEach(ed => {
      const opt = document.createElement("option");
      opt.value = ed;
      opt.text = ed;
      select.appendChild(opt);
    });

    select.addEventListener("change", e => renderizarExtintores(e.target.value));

    // üîπ Renderizar a primeira edifica√ß√£o por padr√£o
    renderizarExtintores(edificacoesArray[0]);
  </script>
</body>
</html>










